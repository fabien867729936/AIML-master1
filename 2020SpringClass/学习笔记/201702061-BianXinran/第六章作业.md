# 第六章作业

## 题目

阅读 https://mp.weixin.qq.com/s/Bn-6Sm9Hxuo0I8JQvvyoVw，
以是否带口罩检测情境应用为例，讨论目标检测应用的过程以及关键问题。

## 回答

目标检测(object detection)是计算机视觉中非常具有挑战性的一项工作，一方面它是其他很多后续视觉任务的基础，另一方面目标检测不仅需要预测区域，还要进行分类，因此问题更加复杂。最近的5年使用深度学习方法进行目标检测取得了很大的突破，因此想写一个系列来介绍这些方法。这些比较重要的方法可以分成两条主线，一条是基于区域候选(region proposal)的方法，即通过某种策略选出一部分候选框再进行后续处理，比如RCNN-SPP-Fast RCNN-Faster RCNN-RFCN等；另一条是直接使用卷积神经网络将图像变换到一个小的尺度，在新的尺度上使用anchor box来预测目标区域，这一类方法包括SSD以及Yolo的各个版本等；另外这个系列中也会穿插一些其他的算法如OverFeat、DPM等。
1、算法模型
基于深度学习的人脸检测算法，多数都是基于深度学习目标检测算法进行的改进，或者说是把通用的目标检测模型，为适应人脸检测任务而进行的特定配置。而众多的目标检测模型（Faster RCNN、SSD、YOLO）中，人脸检测算法最常用的是SSD算法，例如知名的SSH模型、S3FD模型、RetinaFace算法，都是受SSD算法的启发，或者基于SSD进行的任务定制化改进， 例如将定位层提到更靠前的位置，Anchor大小调整、Anchor标签分配规则的调整，在SSD基础上加入FPN等。
训练目标检测模型，最重要的合理的设置anchor的大小和宽高比，一般会统计数据集的目标物体的宽高比和大小来设置anchor的大小和宽高比。例如，在我们标注的口罩人脸数据集上，我们读取了所有人脸的标注信息，并计算每个人脸高度与宽度的比值，因为人脸的一般是长方形的，而很多图片是比较宽的，例如16:9的图片，人脸的宽度和高度归一化后，有很多图片的高度是宽度的2倍甚至更大。从上图也可以看出，归一化后的人脸高宽比集中在1~2.5之间。所以，根据数据的分布，我们将五个定位层的anchor的宽高比统一设置为1，0.62, 0.42。（转换为高宽比，也就是约1，1.6：1，2.4:1）
2、数据集
中科院信工所葛仕明老师开源的MAFA数据集，该数据集本是一个遮挡人脸的数据集，其中有各种被遮挡的人脸图片，大多数都是被口罩遮挡的人脸图片，MAFA数据集的人脸位置定义与WIDER Face有较大区别，MAFA的人脸框在靠近眉毛上方，是正方形的，而且标注框不严格（框离脸部边缘有缝隙），而WIDER Face的人脸框在额头上方，如果不进行修改，会导致模型对于不戴口罩的人脸，检测框是到额头上方，而戴口罩的人脸，检测框只到眉毛上方。
3、部署模型
因为WIDER Face本身是一个稍微复杂的数据集，再加上输入和参数量比较小可以看到对于人脸的AP只有0.896。可以通过设计大一点的模型改善性能。
